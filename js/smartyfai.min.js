/*!
 * SmartyfAI
 * Copyright 2019-2021 SmartyfAI
 */


!(function(jq) {
  "use strict";
  jq('a.js-scroll-trigger[href*="#"]:not([href="#"])').click(function() {
    if (
      location.pathname.replace(/^\//, "") ==
        this.pathname.replace(/^\//, "") &&
      location.hostname == this.hostname
    ) {
      var h = jq(this.hash);
      if ((h = h.length ? h : jq("[name=" + this.hash.slice(1) + "]")).length)
        return (
          jq("html, body").animate(
            { scrollTop: h.offset().top - 54 },
            1000,
            "easeInOutExpo"
          ),
          false
        );
    }
  }),
    jq(".js-scroll-trigger").click(function() {
      jq(".navbar-collapse").collapse("hide");
    }),
    jq("body").scrollspy({ target: "#mainNav", offset: 56 });
  function shrink() {
    100 < jq("#mainNav").offset().top
      ? jq("#mainNav").addClass("navbar-shrink")
      : jq("#mainNav").removeClass("navbar-shrink");
  }
  shrink(), jq(window).scroll(shrink);


  // Popup menu

  $("[data-toggle='popover']")
    .popover()
    .click(function () {
      var $this = $(this);
      var wasShown = $this.attr('aria-describedby');
      $("[data-toggle='popover']").popover('hide');
      if (!wasShown) {
        $this.popover('show');
      }
    });
  $(document).click(function (event) {
    var $target = $(event.target);
    var isPopover = $target.is("[data-toggle='popover'], .popover");
    var popoverParent = $target.parents("[data-toggle='popover'], .popover");
    if (!isPopover && popoverParent.length == 0) {
      $("[data-toggle='popover']").popover('hide');
    }
  });
  const $dropdown = $('.dropdown');
  const $dropdownToggle = $('.dropdown-toggle');
  const $dropdownMenu = $('.dropdown-menu');
  const showClass = 'show';
  $(window).on('load resize', function () {
    if (this.matchMedia('(min-width: 1200px)').matches) {
      $dropdown.hover(
        function () {
          const $this = $(this);
          $this.addClass(showClass);
          $this.find($dropdownToggle).attr('aria-expanded', 'true');
          $this.find($dropdownMenu).addClass(showClass);
        },
        function () {
          const $this = $(this);
          $this.removeClass(showClass);
          $this.find($dropdownToggle).attr('aria-expanded', 'false');
          $this.find($dropdownMenu).removeClass(showClass);
        }
      );
    } else {
      $dropdown.off('mouseenter mouseleave');
    }
  });
  if (navigator.userAgent.search('Firefox') >= 0) {
    $('#navbarNav').addClass('firefox');
  }


})(jQuery);

// Email hiding

function defMail(pre, nom)
{
  var user = pre+"."+nom
 var domain = "smartyfai.com";
 var mail = user + "@" + domain;
 var ref = "mailto:"+mail;

       document.getElementById(pre).href=ref;
}

function hideMail(pre)
{
       document.getElementById(pre).href="#";
}

// Contact form :

$(function () {
  let successAlert = $('#success .alert-success');
  let dangerAlert = $('#success .alert-danger');
  function resetAlerts() {
    successAlert.addClass('d-none');
    dangerAlert.addClass('d-none');
  }
  let form = $('form#contactForm');
  let domform = form[0];
  form.submit(function (event) {
    event.preventDefault();
    resetAlerts();
    if (domform.checkValidity() === true) {
      var name = $('input#name').val();
      var email = $('input#email').val();
      var message = $('textarea#message').val();
      $this = $('#sendMessageButton');
      $this.prop('disabled', true);
      $.ajax({
        url: domform.action,
        type: domform.method,
        dataType: 'json',
        data: { name: name, _replyto: email, message: message },
        cache: false,
        success: function () {
          successAlert.alert();
          successAlert.removeClass('d-none');
          form.removeClass('was-validated');
          form.trigger('reset');
        },
        error: function () {
          dangerAlert.alert();
          dangerAlert.removeClass('d-none');
        },
        complete: function () {
          setTimeout(function () {
            $this.prop('disabled', false);
          }, 1000);
        },
      });
    } else {
      form.addClass('was-validated');
    }
  });
  $('form#contactForm .form-control').focus(resetAlerts);
  $('#success .alert-success, #success .alert-danger').on(
    'close.bs.alert',
    function (e) {
      e.preventDefault();
      $(this).addClass('d-none');
    }
  );
});
